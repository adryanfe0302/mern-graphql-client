(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{198:function(e,t,a){e.exports=a(217)},203:function(e,t,a){},216:function(e,t,a){},217:function(e,t,a){"use strict";a.r(t);var n=a(79),r=a.n(n),o=(a(203),function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,244)).then(function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,o=t.getLCP,l=t.getTTFB;a(e),n(e),r(e),o(e),l(e)})}),l=a(0),c=a.n(l),s=a(39),m=a(12),i=a(233),u=a(11),d=a(55),p=a(176),b=a.n(p),g={user:null};if(localStorage.getItem("jwtToken")){var E=b()(localStorage.getItem("jwtToken"));1e3*E.exp<Date.now()?localStorage.removeItem("jwtToken"):g.user=E}var f=Object(l.createContext)({user:null,login:function(e){},logout:function(){}});function v(e,t){switch(t.type){case"LOGIN":return Object(d.a)(Object(d.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(d.a)(Object(d.a)({},e),{},{user:null});default:return e}}function h(e){var t=Object(l.useReducer)(v,g),a=Object(u.a)(t,2),n=a[0],r=a[1];return c.a.createElement(f.Provider,Object.assign({value:{user:n.user,login:function(e){localStorage.setItem("jwtToken",e.token),r({type:"LOGIN",payload:e})},logout:function(){localStorage.removeItem("jwtToken"),r({type:"LOGOUT"})}}},e))}var j=a(187);var O,y=function(e){var t=e.component,a=Object(j.a)(e,["component"]),n=Object(l.useContext)(f).user;return c.a.createElement(m.b,Object.assign({},a,{render:function(e){return n?c.a.createElement(m.a,{to:"/"}):c.a.createElement(t,e)}}))},C=a(27),w=a(242),I=a(237),k=a(239),P=a(183),S=a(234),x=a(240),$=a(109),A=a(143),N=a(113),L=a.n(N),D=a(30),T=a(31),Q=a.n(T);function R(e){var t=e.user,a=e.post,n=a.id,r=a.likes,o=a.likeCount,m=Object(l.useState)(!1),i=Object(u.a)(m,2),d=i[0],p=i[1];Object(l.useEffect)(function(){t&&r.find(function(e){return e.username===t.username})?p(!0):p(!1)},[t,r]);var b=Object(C.a)(z,{variables:{postId:n}}),g=Object(u.a)(b,1)[0],E=t?d?c.a.createElement(x.a,{color:"teal"}," ",c.a.createElement($.a,{name:"heart"})," "):c.a.createElement(x.a,{color:"teal",basic:!0},c.a.createElement($.a,{name:"heart"})):c.a.createElement(x.a,{as:s.b,to:"/login",color:"teal",basic:!0},c.a.createElement($.a,{name:"heart"}));return c.a.createElement(x.a,{labelPosition:"right",onClick:g},E,c.a.createElement(A.a,{basic:!0,color:"teal",pointing:"left"},o))}var q,F,U,z=Q()(O||(O=Object(D.a)(["\n    mutation likePost($postId: ID!){\n        likePost(postId: $postId){\n            id\n            likes{\n                id username\n            }\n            likeCount\n        }\n    }\n"]))),B=a(238),G=Q()(q||(q=Object(D.a)(["\n  {\n    getPosts {\n      id\n      body\n      createdAt\n      username\n      likeCount\n      likes {\n        username\n      }\n      commentCount\n      comments {\n        id\n        username\n        createdAt\n        body\n      }\n    }\n  }\n"])));var M=Q()(F||(F=Object(D.a)(["\n    mutation deletePost($postId: ID!){\n        deletePost(postId: $postId)\n    }\n"]))),H=Q()(U||(U=Object(D.a)(["\n    mutation deleteComment(\n        $postId: ID!,\n        $commentId: ID!\n    ){\n        deleteComment(\n            postId: $postId,\n            commentId: $commentId\n        ){\n            id body createdAt username likeCount commentCount\n            likes{\n                id username createdAt\n            }\n            comments{\n                id body username createdAt\n            }\n        }\n    }\n"]))),J=function(e){var t=e.postId,a=e.commentId,n=e.callback,r=Object(l.useState)(!1),o=Object(u.a)(r,2),s=o[0],m=o[1],i=a?H:M,d=Object(C.a)(i,{update:function(e){if(m(!1),!a){var r=e.readQuery({query:G});console.log("proxy data",r),r.getPosts=r.getPosts.filter(function(e){return e.id!==t}),console.log("proxy data 2",r),e.writeQuery({query:G,data:r})}n&&n()},variables:{postId:t,commentId:a}}),p=Object(u.a)(d,1)[0];return c.a.createElement(c.a.Fragment,null,c.a.createElement(S.a,{content:a?"delete comment":"delete post",inverted:!0,trigger:c.a.createElement(x.a,{as:"div",color:"red",floated:"right",onClick:function(){return m(!0)}},c.a.createElement($.a,{name:"trash",style:{margin:"0px"}}))}),c.a.createElement(B.a,{open:s,onCancel:function(){return m(!1)},onConfirm:p}))};var V,K=function(e){var t=e.post,a=t.body,n=t.createdAt,r=t.id,o=t.username,m=t.likeCount,i=t.commentCount,u=t.likes,d=Object(l.useContext)(f).user;return c.a.createElement(k.a,{fluid:!0},c.a.createElement(k.a.Content,null,c.a.createElement(P.a,{floated:"right",size:"mini",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"}),c.a.createElement(k.a.Header,null,o),c.a.createElement(k.a.Meta,{as:s.b,to:"/post/".concat(r)},L()(n).fromNow(!0)),c.a.createElement(k.a.Description,null,a)),c.a.createElement(k.a.Content,{extra:!0},c.a.createElement(R,{user:d,post:{id:r,likes:u,likeCount:m}}),c.a.createElement(S.a,{content:"comment on post",inverted:!0,trigger:c.a.createElement(x.a,{labelPosition:"right",as:s.b,to:"/posts/".concat(r)},c.a.createElement(x.a,{color:"blue",basic:!0},c.a.createElement($.a,{name:"comments"})),c.a.createElement(A.a,{basic:!0,color:"blue",pointing:"left"},i))}),d&&d.username===o&&c.a.createElement(J,{postId:r})))},W=a(184),X=a(235),Y=a(112),Z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object(l.useState)(t),n=Object(u.a)(a,2),r=n[0],o=n[1];return{onChange:function(e){console.log("here",Object(d.a)(Object(d.a)({},r),{},Object(Y.a)({},e.target.name,e.target.value))),o(Object(d.a)(Object(d.a)({},r),{},Object(Y.a)({},e.target.name,e.target.value)))},onSubmit:function(t){t.preventDefault(),e()},values:r}};var _=Q()(V||(V=Object(D.a)(["\n    mutation createPost(\n        $body: String!\n    ){\n        createPost(body: $body){\n            id body createdAt username \n            comments {\n                id body username createdAt\n            }\n            likes{\n                id username createdAt\n            } \n            likeCount commentCount\n        }\n    }\n"]))),ee=function(){var e=Z(function(){l()},{body:""}),t=e.values,a=e.onChange,n=e.onSubmit,r=Object(C.a)(_,{variables:t,update:function(e,a){console.log("proxy",e);var n=e.readQuery({query:G});console.log("proxy data",n),n.getPosts=[a.data.createPost].concat(Object(W.a)(n.getPosts)),console.log("data.getPosts",n.getPosts),e.writeQuery({query:G,data:n}),console.log("data.writeQuery",{query:G,data:n}),t.body=""}}),o=Object(u.a)(r,2),l=o[0],s=o[1].error;return c.a.createElement(c.a.Fragment,null,c.a.createElement(X.a,{onSubmit:n},c.a.createElement("h2",null," Create a post:"),c.a.createElement(X.a.Field,null,c.a.createElement(X.a.Input,{placeholder:"hi world",name:"body",onChange:a,value:t.body,error:!!s}),c.a.createElement(x.a,{type:"submit",color:"teal"},"Submit"))),s&&c.a.createElement("div",{className:"ui error message",style:{marginBottom:"20px"}},c.a.createElement("ul",{className:"list"},c.a.createElement("li",null,s.graphQLErrors[0].message))))};var te,ae,ne,re=function(){var e=Object(l.useContext)(f).user,t=Object(C.b)(G),a=t.loading,n=t.data,r=(n=void 0===n?{}:n).getPosts;return c.a.createElement(w.a,{columns:3},c.a.createElement(w.a.Row,{className:"page-title"},c.a.createElement("h1",null,"Recent Posts")),c.a.createElement(w.a.Row,null,e&&c.a.createElement(w.a.Column,null,c.a.createElement(ee,null)),a?c.a.createElement("h1",null,"Loading posts.."):c.a.createElement(I.a.Group,null,r&&r.map(function(e){return c.a.createElement(w.a.Column,{key:e.id,style:{marginBottom:20}},c.a.createElement(K,{post:e}))}))))},oe=Q()(te||(te=Object(D.a)(["\n    mutation login(\n        $username: String!\n        $password: String!\n    ){\n        login(username: $username password: $password){\n            # return\n            id\n            email\n            token\n            createdAt\n            username\n        }\n    }\n"]))),le=function(e){var t=Object(l.useContext)(f),a=Z(function(){g()},{username:"",password:""}),n=a.onChange,r=a.onSubmit,o=a.values,s=Object(l.useState)(""),m=Object(u.a)(s,2),i=m[0],d=m[1],p=Object(C.a)(oe,{update:function(a,n){var r=n.data.login;t.login(r),e.history.push("/")},onError:function(e){console.log("err",e),d(e.graphQLErrors[0].extensions.exception.errors)},variables:{username:o.username,password:o.password}}),b=Object(u.a)(p,2),g=b[0],E=b[1].loading;return c.a.createElement("div",{className:"form-container"},c.a.createElement(X.a,{onSubmit:r,noValidate:!0,className:E?"loading":""},c.a.createElement("h1",null," Login "),c.a.createElement(X.a.Input,{label:"Username",placeholder:"Username...",name:"username",type:"text",onChange:n,error:!!i.username,values:o.username}),c.a.createElement(X.a.Input,{label:"Password",placeholder:"Password...",name:"password",type:"password",onChange:n,error:!!i.password,values:o.password}),c.a.createElement(x.a,{type:"submit",primary:!0},"Login")),Object.keys(i).length>0&&c.a.createElement("div",{className:"ui error message"},c.a.createElement("ul",{className:"list"},Object.values(i).map(function(e){return c.a.createElement("li",{key:e}," ",e," ")}))))};var ce,se=Q()(ae||(ae=Object(D.a)(["\n    query($postId: ID!){\n        getPost(postId:$postId){\n            id body createdAt username likeCount commentCount\n            likes{\n                username\n            }\n            comments{\n               id username createdAt body\n            }\n        }\n    }\n"]))),me=Q()(ne||(ne=Object(D.a)(["\n    mutation createComment($postId: String!, $body: String!){\n        createComment(\n            postId: $postId,\n            body: $body\n        ){\n            id body createdAt username likeCount commentCount\n            likes{\n                id username createdAt\n            }\n            comments{\n                id body username createdAt\n            }\n        }\n    }\n"]))),ie=function(e){var t=e.match.params.postId,a=Object(l.useContext)(f).user,n=Object(l.useState)(""),r=Object(u.a)(n,2),o=r[0],s=r[1],m=Object(l.useRef)(null);console.log("postId",t);var i,d=Object(C.b)(se,{variables:{postId:t}}).data,p=(d=void 0===d?{}:d).getPost,b=Object(C.a)(me,{update:function(e,t){s(""),m.current.blur()},variables:{postId:t,body:o}}),g=Object(u.a)(b,1)[0];if(p){var E=p.id,v=p.body,h=p.createdAt,j=p.username,O=p.comments,y=p.likes,I=p.likeCount,S=p.commentCount;i=c.a.createElement(w.a,null,c.a.createElement(w.a.Row,null,c.a.createElement(w.a.Column,{width:2},c.a.createElement(P.a,{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",size:"small",float:"rigth"})),c.a.createElement(w.a.Column,{width:10},c.a.createElement(k.a,{fluid:!0},c.a.createElement(k.a.Content,null,c.a.createElement(k.a.Header,null," ",j," "),c.a.createElement(k.a.Meta,null,L()(h).fromNow()),c.a.createElement(k.a.Description,null,v)),c.a.createElement("hr",null),c.a.createElement(k.a.Content,{extra:!0},c.a.createElement(R,{user:a,post:{id:E,likeCount:I,likes:y}}),c.a.createElement(x.a,{as:"div",labelPosition:"right",onClick:function(){console.log("comment post")}},c.a.createElement(x.a,{basic:!0,color:"blue"},c.a.createElement($.a,{name:"comments"})),c.a.createElement(A.a,{basic:!0,color:"blue",pointing:"left"},S)),a&&a.username===j&&c.a.createElement(J,{postId:E,callback:function(){e.history.push("/")}}))),a&&c.a.createElement(k.a,{fluid:!0},c.a.createElement(k.a.Content,null,c.a.createElement("p",null," post comment "),c.a.createElement(X.a,null,c.a.createElement("div",{className:"ui action input fluid"},c.a.createElement("input",{type:"text",placeholder:"comment...",naem:"comment",value:o,onChange:function(e){return s(e.target.value)},ref:m}),c.a.createElement("button",{type:"submit",className:"ui button teal",disabled:""===o.trim(),onClick:g},"submit"))))),O.map(function(e){return c.a.createElement(k.a,{fluid:!0,key:e.id},c.a.createElement(k.a.Content,null,a&&a.username===j&&c.a.createElement(J,{postId:E,commentId:e.id}),c.a.createElement(k.a.Header,null,e.username),c.a.createElement(k.a.Meta,null,L()(e.createdAt).fromNow()),c.a.createElement(k.a.Description,null,e.body)))}))))}else i=c.a.createElement("div",null," loading post... ");return i},ue=Q()(ce||(ce=Object(D.a)(["\n    mutation register(\n        $username: String!\n        $email: String!\n        $password: String!\n        $confirmPassword: String!\n    ){\n        register(\n            registerInput: {\n                username: $username\n                email: $email\n                password: $password\n                confirmPassword: $confirmPassword\n            }\n        ){\n            # return\n            id\n            email\n            token\n            createdAt\n            username\n        }\n    }\n"]))),de=function(e){var t=Object(l.useContext)(f),a=Z(function(){g()},{username:"",email:"",password:"",confirmPassword:""}),n=a.onChange,r=a.onSubmit,o=a.values,s=Object(l.useState)(""),m=Object(u.a)(s,2),i=m[0],d=m[1],p=Object(C.a)(ue,{update:function(a,n){var r=n.data.register;t.login(r),e.history.push("/")},onError:function(e){d(e.graphQLErrors[0].extensions.exception.errors)},variables:{username:o.username,email:o.email,password:o.password,confirmPassword:o.confirmPassword}}),b=Object(u.a)(p,2),g=b[0],E=b[1].loading;return c.a.createElement("div",{className:"form-container"},c.a.createElement(X.a,{onSubmit:r,noValidate:!0,className:E?"loading":""},c.a.createElement("h1",null," Register "),c.a.createElement(X.a.Input,{label:"Username",placeholder:"Username...",name:"username",type:"text",onChange:n,error:!!i.username,values:o.username}),c.a.createElement(X.a.Input,{label:"Email",placeholder:"Email...",name:"email",type:"email",onChange:n,error:!!i.email,values:o.email}),c.a.createElement(X.a.Input,{label:"Password",placeholder:"Password...",name:"password",type:"password",onChange:n,error:!!i.password,values:o.password}),c.a.createElement(X.a.Input,{label:"Confirm Password",placeholder:"Confirm Password...",name:"confirmPassword",type:"password",onChange:n,error:!!i.confirmPassword,values:o.confirmPassword}),c.a.createElement(x.a,{type:"submit",primary:!0},"Register")),Object.keys(i).length>0&&c.a.createElement("div",{className:"ui error message"},c.a.createElement("ul",{className:"list"},Object.values(i).map(function(e){return c.a.createElement("li",{key:e}," ",e," ")}))))},pe=a(236);function be(){var e=window.location.pathname,t="/"===e?"home":e.substr(1),a=Object(l.useState)(t),n=Object(u.a)(a,2),r=n[0],o=n[1],m=Object(l.useContext)(f),i=m.user,d=m.logout,p=function(e,t){var a=t.name;return o(a)};return console.log("user",i),i?c.a.createElement(pe.a,{pointing:!0,secondary:!0,size:"massive",color:"teal"},c.a.createElement(pe.a.Item,{name:i.username,active:!0,as:s.b,to:"/"}),c.a.createElement(pe.a.Menu,{position:"right"},c.a.createElement(pe.a.Item,{name:"logout",onClick:d}))):c.a.createElement(pe.a,{pointing:!0,secondary:!0,size:"massive",color:"teal"},c.a.createElement(pe.a.Item,{name:"home",active:"home"===r,onClick:p,as:s.b,to:"/"}),c.a.createElement(pe.a.Menu,{position:"right"},c.a.createElement(pe.a.Item,{name:"login",active:"login"===r,onClick:p,as:s.b,to:"/login"}),c.a.createElement(pe.a.Item,{name:"register",active:"register"===r,onClick:p,as:s.b,to:"/register"})))}a(215),a(216);var ge=function(){return c.a.createElement(h,null,c.a.createElement(s.a,null,c.a.createElement(i.a,null,c.a.createElement(be,null),c.a.createElement(m.b,{exact:!0,path:"/",component:re}),c.a.createElement(y,{exact:!0,path:"/login",component:le}),c.a.createElement(y,{exact:!0,path:"/register",component:de}),c.a.createElement(m.b,{exact:!0,path:"/posts/:postId",component:ie}))))},Ee=a(75),fe=a(186),ve=a(185),he=a(28),je=a(188),Oe=Object(ve.a)({uri:"https://sosmed-graphql.herokuapp.com/"}),ye=Object(je.a)(function(){var e=localStorage.getItem("jwtToken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}}),Ce=new Ee.c({link:ye.concat(Oe),cache:new fe.a}),we=c.a.createElement(he.a,{client:Ce},c.a.createElement(ge,null));r.a.render(we,document.getElementById("root")),o()}},[[198,1,2]]]);
//# sourceMappingURL=main.2dd0dc36.chunk.js.map